<!-- Sidebar -->
<nav class="sidebar" [class.collapsed]="(isSidebarCollapsed$ | async) ?? false">
  <div class="sidebar-header">
    <div class="sidebar-logo" *ngIf="!(isSidebarCollapsed$ | async)">
      <span class="rotated-letter">ה</span>ערוץ
    </div>
    <button
      class="toggle-sidebar-btn"
      (click)="toggleSidebar()"
      [title]="(isSidebarCollapsed$ | async) ? 'הרחב סרגל צד' : 'כווץ סרגל צד'"
    >
      <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M480-240 240-480l240-240 56 56-184 184 184 184-56 56Zm264 0L504-480l240-240 56 56-184 184 184 184-56 56Z"/></svg>
    </button>
  </div>

  <!-- Search -->
  <div class="search-bar">
    <ng-container *ngIf="!(isSidebarCollapsed$ | async); else searchIcon">
      <input
        #searchInput
        type="text"
        class="search-input"
        placeholder="חיפוש ערוץ..."
        [ngModel]="searchTerm"
        (ngModelChange)="onSearch($event)"
      >
    </ng-container>
    <ng-template #searchIcon>
      <button class="search-icon-btn" (click)="expandAndFocusSearch()" title="חיפוש">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg>
      </button>
    </ng-template>
  </div>
<div class="scrollable-content">
  <!-- Channels List by Category -->
  <div class="channel-list-container">
    <div
      *ngFor="let category of filteredCategories$ | async"
      class="category-drop-zone"
      draggable="true"
      (dragstart)="onCategoryDragStart($event, category)"
      (dragover)="onCategoryDragOver($event)"
      (dragleave)="onCategoryDragLeave($event)"
      (drop)="onCategoryDrop($event, category)"
      (dragend)="onCategoryDragEnd($event)"
    >
      <h3 class="category-header" *ngIf="!(isSidebarCollapsed$ | async)">{{ category.name }}</h3>
      <ul class="site-list"
        (drop)="onDropInCategory($event, category)">
        <li #listItem
          *ngFor="let site of category.sites"
          (click)="selectSite(site)"
          [class.active]="site.name === (activeSiteName$ | async)"
          [title]="site.name"
          draggable="true"
          (dragstart)="onDragStart($event, site, category)"
          (dragover)="onDragOverSite($event, listItem)"
          (dragleave)="onDragLeaveSite($event, listItem)"
          (drop)="onDropOnSite($event, site, category)"
          (dragend)="onDragEnd($event)"
        >
          <img *ngIf="!hasFaviconError(site)" [src]="getFaviconUrl(site.url)" (error)="onFaviconError(site)" class="site-icon" alt="">
          <div *ngIf="hasFaviconError(site)" class="site-icon fallback-icon" [ngStyle]="{'background-color': getColorForSite(site.name)}">{{ getFirstLetter(site.name) }}</div>
          <span class="site-name" *ngIf="!(isSidebarCollapsed$ | async)">{{ site.name }}</span>
          <div class="site-actions" *ngIf="!(isSidebarCollapsed$ | async)">
            <a [href]="site.url" target="_blank" class="action-btn" (click)="$event.stopPropagation()" title="פתח בכרטיסייה חדשה"><svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 -960 960 960" width="18" fill="currentColor"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h560v-280h80v280q0 33-23.5 56.5T760-120H200Zm188-212-56-56 372-372H560v-80h280v280h-80v-144L388-332Z"/></svg></a>
            <button class="action-btn remove-btn" (click)="openConfirmDeleteDialog(site, $event)" title="הסר את הערוץ">×</button>
          </div>
        </li>
      </ul>
    </div>
  </div>


  <!-- Available sites matching search -->
  <div class="available-sites-container" *ngIf="filteredAvailableSites$ | async as sites">
    <div *ngIf="searchTerm && sites && sites.length > 0">
      <h4 class="available-sites-header">הוספה מהירה</h4>
      <ul class="available-site-list">
        <li *ngFor="let site of sites" (click)="addSiteFromAvailable(site)" [title]="site.description">
          <img *ngIf="!hasFaviconError(site)" [src]="getFaviconUrl(site.url)" (error)="onFaviconError(site)" class="site-icon" alt="">
          <div *ngIf="hasFaviconError(site)" class="site-icon fallback-icon" [ngStyle]="{'background-color': getColorForSite(site.name)}">{{ getFirstLetter(site.name) }}</div>
          <span class="site-name" *ngIf="!(isSidebarCollapsed$ | async)">{{ site.name }}</span>
          <button class="action-btn add-btn" *ngIf="!(isSidebarCollapsed$ | async)" title="הוסף ערוץ">+</button>
        </li>
      </ul>
    </div>
  </div>
</div>

  <!-- Add Channel Button -->
  <div class="sidebar-footer">
    <button class="add-channel-btn" (click)="openAddSiteDialog()">
      <span *ngIf="!(isSidebarCollapsed$ | async)">הוסף ערוץ </span>
      <span>+</span>
    </button>
  </div>
</nav>
